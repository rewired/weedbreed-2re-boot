# Weed Breed — Frontend Proposal (Frame + Structure ▸ Room ▸ Zone + HR)

> Principle: **Dumb UI** — read-models in, intents out. Always SI units; economy shown per-hour; rounding on the **view layer** only (default 2 decimals; sensible exceptions max 3). No 1,000-plant grids: **aggregates + samples + clear actions**.

---

## 0) Global Frame

### 0.1 Left Rail (persistent)

Order:

1. **Company**
2. **Structures**
3. **HR**
4. **Strains**
5. *(… future sections, same pattern)*

Behavior:

* Collapsible on narrow viewports; iconized mini-rail option.
* Active item highlighted; breadcrumbs live in the content pane.
* Left rail + **always-visible Sim Control Bar** must never overlap controls/content.

### 0.2 Content Pane

* Houses **Structure / Room / Zone** screens, HR, Strains, Company dashboards.
* **Sticky Sim Control Bar** (top desktop / bottom mobile) is outside the scroll area.

### 0.3 Global “Sim Control Bar” (always visible)

* **Play/Pause**, **Speed:** **1× · 5× · 10× · 25× · 100×**; **Step** when paused.
* **Tick/Clock:** `Day d, hh:mm` (read-only).
* **Balance:** current balance + **Δ per hour** (read-only).
* Intents: `sim.play`, `sim.pause`, `sim.setSpeed {1|5|10|25|100}`, `sim.step`.

---

## 1) Structures (overview) → Room → Zone

### 1.1 Structure View

**See**

* Header: inline rename; total area/volume; **free vs. used**; counts (rooms/zones); tariffs (read-only).
* Health & Pest overview (structure-wide aggregates).
* Capacity & Coverage tiles (lighting coverage vs. demand; HVAC/ACH vs. room volumes; approx power draw per hour).
* Rooms grid with purpose, area/volume, **free capacity**, zone count, warning badges.
* Workforce snapshot: latest actions within this structure.

**Do**

* Inline rename structure.
* Create / **duplicate room** (**inventory as new purchases**, **no plants**).
* **Move devices** within the **same structure** (eligibility + capacity).
* Open **Capacity Advisor** (structure level) for “N devices needed” + neutral Opex/h preview.

---

### 1.2 Room View

**See**

* Header: inline rename; **purpose**; area/volume; **free capacity**; baseline **ACH** target.
* **Zones list (compact):** health/quality %, pest/disease badges, “ready to harvest,” device warnings.
* Room climate/airflow snapshot: targets vs. measured (temp, RH, CO₂, ACH).
* Devices in room: tiles by class with **condition %**, contribution, eligibility.
* Workforce timeline (room): latest tasks.

**Do**

* Inline rename room.
* **Create / duplicate zone** (**no plants**, **inventory as new purchases**).
* **Move zones** within the **same structure** (capacity + purpose + placement scope).
* Set **room baselines** (climate/airflow; clear inheritance/override markers).
* Move / remove / replace devices (within structure; eligibility enforced).

---

### 1.3 Zone View

**See**

* **Aggregated plant KPIs:** health/stress/quality as median/min/max (+ 24h sparkline), % on display.
* **Pest/Disease status:** active/due/cooldown counts; last/next inspection/treatment.
* **Context:** zone area/volume; room area/volume & **free capacity**.
* **Cultivation & Irrigation** badges; derived **max plants** and density hints.
* **Devices:** tiles per class (condition %, contribution, caps; warnings for coverage/airflow).
* **Climate snapshot:** temp, RH, CO₂, VPD, **ACH** (true/measured), status (ok/warn).

**Do**

* **Harvest** (entire zone or sampled subset) → lots to storage/curing.
* **Cull** damaged plants below threshold.
* **Sow** only if **zone empty** (see create/sow flows).
* **Category-level device control** (global targets; minimal per-device toggles/caps).
* Move/remove devices within the **same structure**.

---

## 2) Collapsible Control Cards (Lighting & Climate)

**Pattern (both cards):**

* **Header (always visible):** shows **current (measured)** values + small **targets**; deviation badges.
* **Expanded:**

  1. **Global targets** (sliders/inputs).
  2. **Device tiles** (installed classes active; missing classes **ghosted** with “Open Capacity Advisor”).

**Lighting**

* Header: PPFD current (big) + target (small); **DLI current/target** pill; coverage status.
* Expanded: `targetPPFD_umol_m2s`; **Light Schedule editor** (15-min grid; **sum = 24h**); DLI preview; device tiles (condition %, contribution, cap %, enable/disable; move/remove).

**Climate**

* Header: Temp current/target; RH current/target; CO₂ current/target; **ACH** current/target.
* Expanded: `targetTemp_C`, `targetRH_pct`, `targetCO2_ppm`, `targetACH_h`; device tiles (AC/HVAC, fans, filters, heaters, humidifiers/dehumidifiers, CO₂) with condition %, throughput/cap %, enable/disable; move/remove.

**Intents:** `lighting.setTarget`, `lighting.setSchedule`; `climate.setTargets`, `airflow.setACH`; `device.enable/disable/move/remove`, `device.setCap`.

---

## 3) Inline Rename & Duplicate

* **Inline rename**: **Structure**, **Room**, **Zone** (plants/devices cannot be renamed). Validate emptiness/length/characters; engine re-validates.
* **Duplicate room**: copies zones **without plants**, **inventory as new purchases**; select all or some zones; blocks on capacity/eligibility/schedule/CM-Irrigation issues; preview **N devices needed** + neutral Opex/h.
* **Duplicate zone**: **no plants**, **inventory as new purchases**; choose target room (same structure) and **#copies**; same validation/preview rules.

---

## 4) Create Flows & Sowing

**Room Create**

* Inputs: name, **area (m²)**, **height (m)** (optional), purpose.
* Checks: structure free area/volume; numeric validation.
* Intent: `room.create { structureId, name, area_m2, height_m?, purpose? }`.

**Zone Create (wizard; CM & Irrigation mandatory)**

* Step A: name, **zone area (m²)** (validated vs. room free area).
* Step B: **Cultivation Method** + **Irrigation Method**; compatibility badges **ok / warn / block**; **block** prevents creation.
* Step C (derived & costs): **Max plants** = `floor(area_m2 / cm.areaPerPlant_m2)`; **acquisition cost** (seedling + container + substrate per area [+ basic irrigation line if applicable]); neutral display; **devices not included** here.
* Intent: `zone.create { roomId, name, area_m2, cultivationMethodId, irrigationMethodId }`.

**Sowing (seedlings)**

* Preconditions: zone **empty**, CM & Irrigation set.
* Inputs: **strain**, **count** (≤ maxPlants).
* Checks: strain vs. CM/Irrigation (**ok/warn/block**); block if incompatible or over capacity.
* Cost preview: seedlings (plus container/substrate if still applicable).
* Intent: `plants.sow { zoneId, strainId, count }`.

**Set/Update Area**

* `room.setArea { roomId, area_m2 }` and `zone.setArea { zoneId, area_m2 }` (updates capacities/derived maxPlants).

---

## 5) HR (Left Rail ▸ HR)

**Goal:** Visibility into **people and work** tied to structures/rooms/zones; **read-only telemetry** plus clear **intents** for assignment and tasking, aligned with what we already surface in structure/room/zone timelines.

**HR — What I see**

* **Workforce Directory:** list/grid of employees with role (gardener, technician, janitor, …), skill tags, **current assignment** (structure/room/zone), **recent activity**, **overtime flag**, **condition/morale** indicator, **hourly cost** (neutral per-hour displayed).
* **Activity Timeline (global HR):** latest tasks across the company (inspection, treatment, harvest, maintenance) with who/where/when/duration; filters by structure/room/zone/role.
* **Task Queues (read-only):** upcoming or in-progress zone/room tasks (e.g., inspections due, treatments scheduled, harvest planned); shows assignee if available.
* **Capacity Snapshot:** headcount by role, open tasks vs. available headcount; simple **coverage hint** (e.g., inspections due today vs. gardeners available).

**HR — What I can do**

* **Assign / reassign** employee to **structure/room/zone** (within constraints).
* **Acknowledge/launch** zone **inspection** or **treatment** (mirrors the buttons surfaced in Zone P&D panel—same intents, just central entry point).
* **Acknowledge/launch** **maintenance** tasks for devices (if pending).
* *(Payroll, raises, and deeper economics remain neutral/read-only here; we only display per-hour where needed.)*

**Intents (HR surface; already used elsewhere)**

* `hr.assign { employeeId, target: structureId|roomId|zoneId }`
* `pest.inspect.start/complete { zoneId }`, `pest.treat.start/complete { zoneId }`
* `maintenance.start/complete { deviceId }`
* *(All write actions mirror the same domain intents already used from Room/Zone; HR provides a central place to trigger them.)*

**Cross-linking**

* From HR Directory card → jump to the assigned **Structure/Room/Zone**.
* From a Room/Zone timeline item → jump to the **Employee** profile card in HR.

---

## 6) Movement Rules (recap)

* **Zones and devices move only within the same structure.**
* **Placement eligibility** (class ↔ room purpose/placement scope) must hold.
* Move pickers show **only valid targets**; failures explain the exact reason.

---

## 7) Display, Units, Rounding, i18n

* Units: °C, %RH, ppm, m³/h, µmol·m⁻²·s⁻¹, mol·m⁻²·d⁻¹, m², m³.
* Rounding: default **2 decimals**, sensible exceptions **max 3**.
* Locale switch (DE/EN) affects formatting only; data remains SI.

---

## 8) Read-Models (summary)

* **SimulationRM**, **EconomyRM**.
* **StructureRM**, **RoomRM**, **ZoneRM** as defined (capacity, coverage, devices, KPIs, timelines).
* **PriceBook/Catalog** (seedlings, container, substrate per m², irrigation line; device coverage m² & throughput m³/h).
* **Compatibility maps**: CM ↔ Irrigation; Strain ↔ CM/Irrigation.
* **HRRM**: employees (role, skills, assignment, condition/morale, hourly cost), activity timeline, task queues.

---

## 9) Intents (summary)

* Sim: `sim.play`, `sim.pause`, `sim.setSpeed`, `sim.step`
* Naming & Create: `structure.rename`, `room.rename`, `zone.rename`, `room.create`, `zone.create`, `room.setArea`, `zone.setArea`
* Duplicate & Move: `room.duplicate`, `zone.duplicate`, `zone.move`, `device.move`, `device.remove`, `device.replace`
* Controls: `lighting.setTarget`, `lighting.setSchedule`, `climate.setTargets`, `airflow.setACH`, `device.enable/disable`, `device.setCap`
* Plants: `plants.sow`
* HR surface: `hr.assign`, `pest.inspect.*`, `pest.treat.*`, `maintenance.*` (same domain actions as elsewhere)

---

## 10) Acceptance Highlights

* **Frame:** Left rail with **Company / Structures / HR / Strains / …** present on all screens; content pane respects sticky Sim Control Bar.
* **Sim bar:** visible everywhere; speeds exactly **1×/5×/10×/25×/100×**; balance + Δ/h formatted per locale.
* **Structures/Rooms/Zones:** as specified (capacity/coverage diagnostics; no giant plant lists; aggregates + sample actions).
* **Control Cards:** headers always show **current** values; expanded shows **global targets** + device tiles; missing classes **ghosted** with advisor CTA; **light schedule** enforces 24h.
* **Inline rename** (structure/room/zone only). **Duplicate** room/zone creates **no plants**, **inventory as new**; validation & previews applied.
* **Create flows:** Room area/height; Zone wizard **requires CM & Irrigation**; shows **max plants** + **acquisition cost** live; blocks on incompatibility/space.
* **Sowing:** compatibility (ok/warn/block), cost preview; blocks beyond maxPlants/incompatible.
* **HR:** directory, activity timeline, task queues; central assignment & task launch (same intents as Room/Zone); cross-links work both ways.

---

## 11) Coarse Work Packages (for later Codex tasking)

1. **Global Shell & Navigation**

   * Left Rail + Content Pane + Sim Control Bar
   * Routing + guards, sticky layout, i18n & formatting

2. **Read-Model Layer**

   * StructureRM/RoomRM/ZoneRM aggregation
   * HRRM (directory, activity, task queues)
   * PriceBook/Catalog + compatibility maps

3. **Structures Module**

   * Structure overview (tiles, rooms grid, workforce snapshot)
   * Device move entry points + capacity/coverage tiles

4. **Room Module**

   * Header + zones list + climate/airflow snapshot
   * Zone/device movement within structure
   * Room baselines (targets + override markers)

5. **Zone Module**

   * KPI aggregates + P&D panel + actions (harvest/cull/sow entry)
   * Device tiles & warnings; climate snapshot

6. **Control Cards**

   * Lighting card (targets, schedule editor with 24h validation, DLI preview)
   * Climate card (targets including ACH)
   * Ghosted classes + Capacity Advisor hooks

7. **Create & Duplicate Flows**

   * Room create (area/height)
   * Zone create wizard (area → CM/Irrigation → derived + cost)
   * Sowing dialog (compatibility + cost)
   * Room/Zone duplicate dialogs (validation + previews)

8. **Inline Rename & Move**

   * Editable titles (structure/room/zone)
   * Zone/device move flows with filtered targets and explicit error reasons

9. **Validation & Tests**

   * Capacity/eligibility; CM/Irrigation compatibility
   * Schedule 24h validator; duplication constraints
   * Intent error surfacing; rounding/i18n formatting; HR assignment actions
