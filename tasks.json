[
  {
    "id": "WB-001",
    "title": "Initialize pnpm monorepo & packages (engine, facade, transport, tools)",
    "rationale": "Standardisierte Workspace-Struktur für Engine (headless), Façade, Transportadapter, CLI/Monitor.",
    "deliverables": [
      "pnpm workspaces with ESM TypeScript configs",
      "packages: @wb/engine, @wb/facade, @wb/transport-sio, @wb/tools-monitor",
      "root scripts: dev/build/test/lint/format"
    ],
    "acceptance": [
      "pnpm -r build succeeds",
      "Shared tsconfig + path aliases working"
    ],
    "refs": ["SEC §0.1", "AGENTS §1", "TDD §2"],
    "labels": ["bootstrap", "backend-core"],
    "deps": []
  },
  {
    "id": "WB-002",
    "title": "Canonical constants module (simConstants.ts) with SEC precedence",
    "rationale": "Eine Quelle der Wahrheit; keine Magic Numbers.",
    "deliverables": [
      "src/backend/src/constants/simConstants.ts",
      "export: AREA_QUANTUM_M2=0.5, ROOM_DEFAULT_HEIGHT_M=3, HOURS_PER_TICK=1, calendar constants"
    ],
    "acceptance": [
      "Engine/Facade importieren ausschließlich aus simConstants.ts",
      "ESLint rule bans duplicates; TDD constants test green"
    ],
    "refs": ["SEC §1.2", "TDD §1"],
    "labels": ["backend-core", "governance"],
    "deps": ["WB-001"]
  },
  {
    "id": "WB-003",
    "title": "ADR: Normalize AREA_QUANTUM_M2 to 0.5 and patch DD/AGENTS/VISION",
    "rationale": "SEC gewinnt; Dokumente angleichen, Inkonsistenz beseitigen.",
    "deliverables": [
      "ADR-0001 constants-alignment.md",
      "Patches in DD.md/AGENTS.md/VISION_SCOPE.md (0.25 -> 0.5)"
    ],
    "acceptance": [
      "Docs bauen ohne Widersprüche",
      "TDD constants spec grün"
    ],
    "refs": ["SEC §1.2", "DD §2", "AGENTS §3", "VISION §4"],
    "labels": ["docs", "adr"],
    "deps": ["WB-002"]
  },
  {
    "id": "WB-004",
    "title": "Core domain types & world tree (Company→Structure→Room→Zone→Plant→Device)",
    "rationale": "Typsichere Grundlage für Engine-Logik und Validatoren.",
    "deliverables": [
      "TypeScript domain models (readonly props for derived fields omitted)",
      "Enums: roomPurpose; placementScope"
    ],
    "acceptance": [
      "Types compile; no any leaks",
      "Unit tests for type guards"
    ],
    "refs": ["SEC §2", "DD §3"],
    "labels": ["backend-core"],
    "deps": ["WB-002"]
  },
  {
    "id": "WB-005",
    "title": "Zod schemas & façade validation (zones require cultivationMethod, placement rules)",
    "rationale": "Fail-fast Laden & Intent-Validierung.",
    "deliverables": [
      "Zod schemas for Company/Structure/Room/Zone/Plant/Device",
      "Rules: zones only in growrooms; device.allowedRoomPurposes + placementScope enforced"
    ],
    "acceptance": [
      "Invalid savegame fails to load with precise errors",
      "Integration spec for placement passes"
    ],
    "refs": ["SEC §1.1, §7.5", "TDD §3, §6, §9"],
    "labels": ["validation", "backend-core"],
    "deps": ["WB-004"]
  },
  {
    "id": "WB-006",
    "title": "RNG utility with stream IDs & reproducibility tests",
    "rationale": "Determinismus überall, keine Math.random in Logik.",
    "deliverables": [
      "createRng(seed, streamId) + doc",
      "Streams: plant:<uuid>, device:<uuid>, economy:<scope>"
    ],
    "acceptance": [
      "1000 draws equal across two instances per stream",
      "No usage of Math.random in engine (lint rule)"
    ],
    "refs": ["SEC §5", "TDD §4"],
    "labels": ["determinism"],
    "deps": ["WB-001"]
  },
  {
    "id": "WB-007",
    "title": "Tariff resolution (electricity/water) with difficulty override>factor",
    "rationale": "Per-hour Ökonomie, feste Tarife zum Sim-Start.",
    "deliverables": [
      "resolveTariffs(cfg,difficulty) util",
      "BackendConfig interface"
    ],
    "acceptance": [
      "Unit: override beats factor; both resources",
      "No *_per_tick monetary fields in codebase"
    ],
    "refs": ["DD §5, §15", "SEC §3.6, §3.6.1", "TDD §8"],
    "labels": ["economy"],
    "deps": ["WB-002"]
  },
  {
    "id": "WB-008",
    "title": "Light schedule validator (15-min grid, on+off=24, startHour∈[0,24))",
    "rationale": "Photoperiod als erstklassiger Vertrag.",
    "deliverables": [
      "validateLightSchedule(on,off,start)",
      "DLI integration hook signature"
    ],
    "acceptance": [
      "Unit spec clamps to grid and enforces sum=24",
      "Used by façade on load/intents"
    ],
    "refs": ["SEC §8", "DD §7", "AGENTS §8", "TDD §5"],
    "labels": ["physiology", "validation"],
    "deps": ["WB-005"]
  },
  {
    "id": "WB-009",
    "title": "Tick pipeline skeleton (7 phases) with tracing & profiling hooks",
    "rationale": "Deterministische Reihenfolge, Performance-Messpunkte.",
    "deliverables": [
      "Engine.runTick() orchestrating phases 1..7",
      "Trace object for tests; perf hooks"
    ],
    "acceptance": [
      "Integration test asserts exact order",
      "Perf harness exists (baseline)"
    ],
    "refs": ["SEC §4.2", "DD §6", "TDD §7, §13"],
    "labels": ["backend-core", "performance"],
    "deps": ["WB-004", "WB-006", "WB-008"]
  },
  {
    "id": "WB-010",
    "title": "Device power→heat coupling & capacity surfaces",
    "rationale": "Elektrische Leistung → sensible Wärme (realistische Koppelung).",
    "deliverables": [
      "Thermo util (applyDeviceHeat) with Cp_air and zone air mass",
      "Device blueprint essentials: power_W, efficiency01, coverage/airflow"
    ],
    "acceptance": [
      "Module test raises temp given waste heat",
      "Coverage/capacity checks in place"
    ],
    "refs": ["SEC §6.1", "DD §8", "TDD §10"],
    "labels": ["devices", "thermo"],
    "deps": ["WB-009"]
  },
  {
    "id": "WB-011",
    "title": "Quality/Condition model (Option A) on canonical [0,1] scale",
    "rationale": "Einheitliche Engine-Skala; UI mappt 0–100%.",
    "deliverables": [
      "Device instance quality01 immutable; condition01 dynamic",
      "Degradation, maintenance, repair thresholds (stubs)"
    ],
    "acceptance": [
      "Read-model exposes both (engine scale)",
      "No % used inside engine"
    ],
    "refs": ["SEC §6.2", "AGENTS §6"],
    "labels": ["devices", "economy"],
    "deps": ["WB-004", "WB-006"]
  },
  {
    "id": "WB-012",
    "title": "Data layout & loaders for /data/blueprints and /data/prices",
    "rationale": "Blueprints ≠ Instanzen; Preise getrennt.",
    "deliverables": [
      "Loader with immutability guard",
      "Folders: strains, devices, cultivationMethods, substrates, containers; prices/ (electricity, water, ...)"
    ],
    "acceptance": [
      "Attempt to mutate blueprint throws",
      "Schema validation on load passes"
    ],
    "refs": ["DD §4", "SEC §1 (Blueprint rule)"],
    "labels": ["data", "validation"],
    "deps": ["WB-005"]
  },
  {
    "id": "WB-013",
    "title": "CultivationMethod minimum schema + substrates density factor & containers",
    "rationale": "Zonen müssen Methode haben; L↔kg Umrechnung; Kosten/Service life.",
    "deliverables": [
      "Schema: areaPerPlant_m2, containers(capex, serviceLife), substrates(unitPrice, densityFactor_L_per_kg, reusePolicy), irrigationMethodIds"
    ],
    "acceptance": [
      "Zone without cultivationMethod fails",
      "Example methods validated"
    ],
    "refs": ["SEC §7.5", "AGENTS §5.1", "DD §4.1", "TDD §9"],
    "labels": ["data", "backend-core"],
    "deps": ["WB-012"]
  },
  {
    "id": "WB-014",
    "title": "IrrigationMethods catalog (hand-watering, drip) + per-zone config",
    "rationale": "Wasser aus der Leitung (metered), Nährstoffe via Methode; keine initial stocks.",
    "deliverables": [
      "/data/blueprints/irrigationMethods/*.json",
      "Façade intents to select method per zone"
    ],
    "acceptance": [
      "Engine accounts water (m³) and nutrient costs via method usage",
      "Reference zones configured"
    ],
    "refs": ["VISION §3 Reference Scenario", "SEC §7.1–§7.3", "DD §6 (pipeline step 3)"],
    "labels": ["data", "economy"],
    "deps": ["WB-013", "WB-007"]
  },
  {
    "id": "WB-015",
    "title": "Façade transport adapter (Socket.IO default) with strict read-only telemetry",
    "rationale": "Kanaltrennung: Telemetry ≠ Intents.",
    "deliverables": [
      "@wb/transport-sio with server→client telemetry channel",
      "Separate intents ingress; rejects writes on telemetry"
    ],
    "acceptance": [
      "Integration test: inbound on telemetry rejected",
      "Hello-telemetry example renders in monitor"
    ],
    "refs": ["SEC §11", "AGENTS §10", "TDD §11"],
    "labels": ["transport", "backend-integration"],
    "deps": ["WB-009"]
  },
  {
    "id": "WB-016",
    "title": "Terminal monitor (neo-blessed) — read-only dashboards",
    "rationale": "Schnelles Feedback ohne UI; read-only Policy.",
    "deliverables": [
      "@wb/tools-monitor app with tick/time, energy/water/€, zone/plant snapshots"
    ],
    "acceptance": [
      "Runs against dev server; no commands over telemetry"
    ],
    "refs": ["SEC §0.1 (Terminal Monitor)", "AGENTS §1"],
    "labels": ["observability"],
    "deps": ["WB-015"]
  },
  {
    "id": "WB-017",
    "title": "Conformance harness & Golden Master (minimal savegame T0)",
    "rationale": "Deterministische Vergleichsläufe & Hashes.",
    "deliverables": [
      "tests/conformance with 7d & 30d runs",
      "fixtures/golden/world_v1.seed.json; expected hashes/summary"
    ],
    "acceptance": [
      "Daily state hashes stable across platforms",
      "± tolerances per SEC"
    ],
    "refs": ["SEC §0.2, §15", "TDD §12"],
    "labels": ["testing", "determinism"],
    "deps": ["WB-005", "WB-009", "WB-012"]
  },
  {
    "id": "WB-018",
    "title": "Economy accrual (per-hour) & reporting snapshots",
    "rationale": "Kostenaggregation für Energie/Wasser/Wartung ohne *_per_tick.",
    "deliverables": [
      "Economy stage (phase 6) computes kWh, m³, € per tick and aggregates",
      "Read-models for daily rollups"
    ],
    "acceptance": [
      "Unit: kWh=(W/1000)*hours; cost=kWh*tariff.kWh",
      "Integration: daily rollup matches expected"
    ],
    "refs": ["DD §5, §6", "SEC §3.6", "TDD §8"],
    "labels": ["economy"],
    "deps": ["WB-007", "WB-009"]
  },
  {
    "id": "WB-019",
    "title": "LOC guardrails & CI wiring (warn ≥500, fail ≥700 LOC; coverage gates)",
    "rationale": "Wartbarkeit erzwingen.",
    "deliverables": [
      "custom ESLint rule or size-limit check",
      "CI pipeline: lint→unit→module→integration→conformance"
    ],
    "acceptance": [
      "CI fails on oversized files",
      "Coverage ≥ 90% engine/facade"
    ],
    "refs": ["SEC §1.3–§1.4", "TDD §14, §16"],
    "labels": ["quality", "ci"],
    "deps": ["WB-001"]
  },
  {
    "id": "WB-020",
    "title": "Update Vision & Scope reference scenario (remove initial stocks; company node present)",
    "rationale": "Deine Korrektur: keine Start-Bestände; Company im Kanon.",
    "deliverables": [
      "VISION_SCOPE.md patches (explicit: no initial water/nutrient stockpiles; irrigation config per zone; Company→… chain)"
    ],
    "acceptance": [
      "Vision deckt SEC/ DD Regeln ab",
      "Cross-ref to SEC wins banner exists"
    ],
    "refs": ["VISION §3, §4", "DD §0 Executive Summary"],
    "labels": ["docs"],
    "deps": ["WB-003"]
  },
  {
    "id": "WB-021",
    "title": "Populate Appendix B (task crosswalk) & contradictions log",
    "rationale": "Historie bewahren, Migration sichtbar machen.",
    "deliverables": [
      "SEC Appendix B rows for /docs/task/**",
      "docs/re-reboot/contradictions.md entries"
    ],
    "acceptance": [
      "Every task proposal mapped or deferred",
      "No dangling references"
    ],
    "refs": ["SEC Appendix B, C"],
    "labels": ["docs", "governance"],
    "deps": ["WB-001"]
  },
  {
    "id": "WB-022",
    "title": "Photoperiod→plant stage hooks (veg/flower transitions) — scaffolding",
    "rationale": "Stufenlogik an Light-Schedule koppeln.",
    "deliverables": [
      "Stage functions (seed, veg, flower, harvest-ready) with deterministic rules",
      "Strain interfaces for photoperiod sensitivity"
    ],
    "acceptance": [
      "Given 18/6 → veg, switch to 12/12 → flower after rule delay",
      "Unit tests with fixed seeds"
    ],
    "refs": ["SEC §8, §8.1–§8.3", "VISION §5"],
    "labels": ["physiology"],
    "deps": ["WB-008", "WB-009"]
  },
  {
    "id": "WB-023",
    "title": "Inventory hooks (harvest lots, post-harvest stub) & events",
    "rationale": "Pipeline Phase 5 vollständig machen, ohne Post-Processing zu überladen.",
    "deliverables": [
      "Harvest event + lot schema",
      "Telemetry topics: harvest.created, inventory.updated"
    ],
    "acceptance": [
      "Integration: lot created when criteria met",
      "Events visible in monitor"
    ],
    "refs": ["SEC §9", "DD §6 (step 5)", "TDD §7"],
    "labels": ["inventory", "events"],
    "deps": ["WB-022"]
  },
  {
    "id": "WB-024",
    "title": "Read-models v1 (zone/plant/economy snapshots) & Socket.IO emission",
    "rationale": "UI/Monitor füttern; klare, stabile Snapshots.",
    "deliverables": [
      "zoneSummary, plantSummary, economySummary schemas",
      "Emission each commit phase"
    ],
    "acceptance": [
      "Schemas versioned; numbers rounded per spec",
      "Monitor renders live summaries"
    ],
    "refs": ["DD §14", "SEC §12", "TDD §12"],
    "labels": ["observability", "backend-integration"],
    "deps": ["WB-009", "WB-015", "WB-018"]
  }
]
